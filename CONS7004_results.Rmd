---
title: "Simulation results"
output: 
  html_document:
    number_sections: FALSE
    toc: true
    toc_float: true
    theme: united
date: "2025-08-28"
---

```{r setup, include=FALSE}
# load in packages 
library(gamlss)
library(gamlss.dist)
library(ggplot2)
library(dplyr)
library(gamlss.ggplots)
knitr::opts_chunk$set(echo = TRUE)
```

------------------------------------------------------------------------

## The setup 

I'm using this just to show the results, together with the diagnostics, graphs and all the good stuff.

<br>

*Table 1: Simulations proposal of different changing parameters*

|       | Mean         | Variance     | Skewness     | Kurtosis     |
|-------|--------------|--------------|--------------|--------------|
| Sim 1 | constant     | time-varying | \-           | \-           |
| Sim 2 | time-varying | time-varying | \-           | \-           |
| Sim 3 | time-varying | time-varying | constant     | \-           |
| Sim 4 | time-varying | time-varying | \-           | constant     |
| Sim 5 | time-varying | time-varying | constant     | constant     |
| Sim 6 | time-varying | time-varying | time-varying | constant     |
| Sim 7 | time-varying | time-varying | constant     | time-varying |
| Sim 8 | time-varying | time-varying | time-varying | time-varying |

<br> 

Other things to consider: 

1. **Changing temporal resolution:** match the resolution of the Helgoland data, then we could down-sample to see how resolution affects recovery 
2. 

<br>

------------------------------------------------------------------------

## Difference between SST and TF2 {.tabset}

<br>

#### keep everything constant with skewness

<br>

### Model

<br> 

```{r, tis looks different}
n        <- 800
t_index  <- seq_len(n)
t_scaled <- (t_index - 1)/(n - 1)
mu0       <- 10
sigma0   <- 2
nu0      <- 1  # For SST, 1 = symmetrical, > 1 = right skewed, < 1 = left skewed
tau0     <- 10  # for TF2, nu = 10 means close to normal, the lower the number the heavier                    the tails
               # for SST, large tau (e.g 7) thinner tails, close to normal. Small tau means                  fatter tails 

# Slopes (linear change rates)
beta_sigma <- 0.5   # scale increases by 0.5 over full range of t_scaled
beta_nu    <- 0.3   # skewness increases linearly
beta_tau   <- -1    # kurtosis decreases linearly

# changes with time
sigma_t <- pmax(0, sigma0 + beta_sigma * t_scaled)
nu_t    <- nu0    + beta_nu  * t_scaled
tau_t   <- tau0   + beta_tau * t_scaled

y <- rSST(n, mu = mu0, sigma = sigma0, nu = nu0, tau = tau0)
y1 <- rTF2(n, mu = mu0, sigma = sigma0, nu = tau0)
y2 <- rLO(n, mu = mu0, sigma = 1)
y3 <- rSN1(n, mu = mu0, sigma = sigma0, nu = 0)

dat <- data.frame(
  t = t_index,
  t_scaled = t_scaled,
  y = y,
  sd_true = sigma0,
  mu_true = mu0,
  nu_true = nu0,
  tau_true = tau0,
  dist = "SST"
)

dat1 <- data.frame(
  t = t_index,
  t_scaled = t_scaled,
  y = y1,
  sd_true = sigma0,
  mu_true = mu0,
  tau_true = tau0,
  dist = "TF2"
)

dat2 <- data.frame(
  t = t_index,
  t_scaled = t_scaled,
  y = y2,
  sd_true = 1,
  mu_true = mu0,
  dist = "LO"
)

dat3 <- data.frame(
  t = t_index,
  t_scaled = t_scaled,
  y = y3,
  sd_true = sigma0,
  mu_true = mu0,
  nu_true = 0,
  dist = "SN1"
)

dat_all <- bind_rows(dat, dat1, dat2, dat3)

```

```{r, echo=FALSE}
# faceted time series plot
ggplot(dat_all, aes(x = t)) +
  geom_line(
    aes(y = y),
    color = "darkred",
    linewidth = 0.8
  ) +
  labs(
    x = "Time",
    y = "Value"
  ) +
  theme_minimal(base_size = 14) +
  facet_wrap(~dist)

# density plots
ggplot(dat_all, aes(y = y)) +
  geom_density(
    aes(color = dist),
    linewidth = 0.8
  ) +
  labs(
    x = "Density",
    y = "Value"
  ) +
  theme_minimal(base_size = 14) +
  coord_flip()
```



```{r}
## Different family on SST distribution
SSTdat <- gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = SST(), data = dat, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

TF2dat <- gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = TF2(), data = dat, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

LOdat <-  gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = LO(), data = dat, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

SN1dat <-  gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = SN1(), data = dat, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

## Different family for TF2 distribution
SSTdat1 <- gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = SST(), data = dat1, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

TF2dat1 <- gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = TF2(), data = dat1, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

LOdat1 <-  gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = LO(), data = dat1, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

SN1dat1 <-  gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = SN1(), data = dat1, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

## Different family for LO distribution
SSTdat2 <- gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = SST(), data = dat2, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

TF2dat2 <- gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = TF2(), data = dat2, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

LOdat2 <-  gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = LO(), data = dat2, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

SN1dat2 <-  gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = SN1(), data = dat2, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

## Different family for SN1 distribution
SSTdat3 <- gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = SST(), data = dat3, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

TF2dat3 <- gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = TF2(), data = dat3, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

LOdat3 <-  gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = LO(), data = dat3, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)

SN1dat3 <-  gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = SN1(), data = dat3, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE)
)
```

<br> 

### Residuals 

```{r}
moment_bucket(SSTdat) + 
   theme_bw() + 
   ggtitle("(c)") +
   theme(legend.position = "none")

moment_bucket(TF2dat) + 
   theme_bw() + 
   ggtitle("(c)") +
   theme(legend.position = "none")
```

<br>

### Full model summary 

```{r}
summary(SSTdat)
summary(TF2dat)
summary(LOdat)
#
summary(SSTdat1)
summary(TF2dat1)
summary(LOdat1)
#
summary(SSTdat2)
summary(TF2dat2)
summary(LOdat2)
#
summary(SSTdat3)
summary(TF2dat3)
summary(LOdat3)
```

<br>

------------------------------------------------------------------------

### Significant diagnostics

#### AIC 

```{r, echo=FALSE}
aic_tbl <- data.frame(
  model = c("SSTdat", "TF2dat","LOdat","SN1dat","SSTdat1", "TF2dat1", "LOdat1", "SN1dat1","SSTdat2", "TF2dat2", "LOdat2", "SN1dat2", "SSTdat3","TF2dat3", "LOdat3", "SN1dat3"),
  AIC   = c(GAIC(SSTdat, k = 2), GAIC(TF2dat, k = 2), GAIC(LOdat, k = 2), GAIC(SN1dat, k = 2),GAIC(SSTdat1, k = 2), GAIC(TF2dat1, k = 2), GAIC(LOdat1, k = 2), GAIC(SN1dat1, k = 2),GAIC(SSTdat2, k = 2), GAIC(TF2dat2, k = 2), GAIC(LOdat2, k = 2), GAIC(SN1dat2, k = 2), GAIC(SSTdat3, k = 2), GAIC(TF2dat3, k = 2), GAIC(LOdat3, k = 2), GAIC(SN1dat3, k = 2))
)
print(aic_tbl)

```

<br>

```{r, eval=FALSE}
# assess real line of distribution 
#?gamlss::fitDist
ma <- fitDist(y = dat$y, type = "realline")
ma$family

ma1 <- fitDist(y = dat1$y, type = "realline")
ma1$family

```

```{r}
SEP3model <- gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = SEP3(), data = dat1, trace = FALSE)

AIC(SEP3model)

SHINmodel <- gamlss(y ~ 1, sigma.fo = ~ 1, nu.fo = ~ 1, tau.fo = ~ 1, family = SHASHo2(), data = dat1, trace = FALSE)

AIC(SHINmodel)
```

<br> 

------------------------------------------------------------------------

## Simulation 1 {.tabset}

<br>

#### constant mean + time-varying variance 

<br>

### Models

<br>

```{r sim 1 setup, echo=FALSE}
n          <- 800
t_index    <- seq_len(n)
t_scaled   <- (t_index - 1)/(n - 1)   # 0..1
mu0        <- 10
sigma0     <- 1
beta      <- 2                    

sigma_t <- pmax(0, sigma0 + beta * t_scaled)

y <- rSST(n, mu = mu0, sigma = sigma_t, nu = 1, tau = 10)

dat <- data.frame(
  t = t_index,
  t_scaled = t_scaled,
  y = y,
  sd_true = sigma_t,
  mu_true = mu0,
  nu_true = 1,
  tau_true = 7
)
```

```{r plot sim 1, echo=FALSE}
# plot the sim 
ggplot(dat, aes(x = t)) +
  geom_line(
    aes(y = y),
    color = "darkred",
    linewidth = 0.8
  ) +
  labs(
    x = "Time",
    y = "Value"
  ) +
  theme_minimal(base_size = 14)
```

Fitted two models:

1. M0 -> Intercept model (constant variance)
2. M1 -> variance varies smoothly with time 

<br>

```{r fit the models}
# M0: constant variance
m0 <- gamlss(
  y ~ 1,
  sigma.fo = ~ 1,   # constant variance 
  family = LO(),
  data = dat,
  trace = FALSE
)

# M1: sigma varies smoothly with time
m1 <- gamlss(
  y ~ 1,                     
  sigma.fo = ~ t_scaled,   # sigma(t)
  family = LO(),
  data = dat,
  trace = FALSE
)

m2 <- gamlss(
  y ~ 1,                     
  sigma.fo = ~ t_scaled,   # sigma(t)
  family = SST(),
  data = dat,
  trace = FALSE
)

m3 <- gamlss(
  y ~ 1,                     
  sigma.fo = ~ t_scaled,   # sigma(t)
  family = TF2(),
  data = dat,
  trace = FALSE
)
```

<br>

------------------------------------------------------------------------

### Full model summary 

```{r sim 1 model summary }
summary(m0)
summary(m1)
summary(m2)
summary(m3)
```

<br>

------------------------------------------------------------------------

### Significant diagnostics

#### AIC 

```{r AIC, echo=FALSE}
aic_tbl <- data.frame(
  model = c("M0: const sigma", "M1: sigma(t)", "M2: SST model", "M3:  TF2 model"),
  AIC   = c(GAIC(m0, k = 2), GAIC(m1, k = 2), GAIC(m2, k = 2), GAIC(m3, k = 2))
)
print(aic_tbl)
```

As expected, the AIC of the model where variance is in the function of time is lower, therefore a better model fit

<br>

#### Sigma coefficient 

```{r}
summary(m0$sigma.coefficients)
summary(m1$sigma.coefficients)
```

<br>

------------------------------------------------------------------------

### Cross-validation

```{r}

```

<br>

------------------------------------------------------------------------

## Simulation 2 {.tabset}

<br>

#### time-varying mean + time-varying variance 

<br>

### Models

<br>

```{r sim 2 setup, echo=FALSE}
# simulate
n          <- 800
t_index    <- seq_len(n)
t_scaled   <- (t_index - 1)/(n - 1)
sigma0 <- 1
mu0 <- 10
beta <- 2

# Mean varies smoothly 
mu_t     <- pmax(0, mu0 + beta * t_scaled)

# Variance varies with time
sigma_t  <- pmax(0, sigma0 + beta * t_scaled)

y <- rSST(n, mu = mu_t, sigma = sigma_t, nu = 1, tau = 10)

dat <- data.frame(
  t = t_index,
  t_scaled = t_scaled,
  y = y,
  mu_true = mu_t,
  sd_true = sigma_t,
  nu_true = 1,
  tau_true = 7
)
```

```{r plot sim 2, echo=FALSE}
# plot the sim 
ggplot(dat, aes(x = t)) +
  geom_line(
    aes(y = y),
    color = "darkred",
    linewidth = 0.8
  ) +
  labs(
    x = "Time",
    y = "Value"
  ) +
  theme_minimal(base_size = 14)
```

Fitted four models:

1. M0 -> Intercept model (constant mean and variance)
2. M1 -> Only variance varies smoothly with time 
3. M2 -> Only mean varies smoothly with time
4. M3 -> time-varying mean + time-varying variance

<br>

```{r models}
# M0: constant mean + constant variance
m0 <- gamlss(y ~ 1, sigma.fo = ~ 1, family = LO(), data = dat, trace = FALSE)

# M1: time-varying variance only + constant mean
m1 <- gamlss(y ~ 1, sigma.fo = ~ t_scaled, family = LO(), data = dat, trace = FALSE)

# M2: time-varying mean only + constant variance 
m2 <- gamlss(y ~ t_scaled, sigma.fo = ~ 1, family = LO(), data = dat, trace = FALSE)

# M3: time-varying mean + time-varying variance
m3 <- gamlss(y ~ t_scaled, sigma.fo = ~ pb(t_scaled), family = LO(), data = dat, trace = FALSE)

# M4: time-varying mean + time-varying variance (SST fam)
m4 <- gamlss(y ~ t_scaled, sigma.fo = ~ t_scaled, family = SST(), data = dat, trace = FALSE)
```

<br>

------------------------------------------------------------------------

### Full model summary

```{r}
summary(m0)
summary(m1)
summary(m2)
summary(m3)
```

<br>

------------------------------------------------------------------------

### Significant diagnostics

#### AIC 

```{r sim 2 AIC, echo=FALSE}
aic_tbl <- data.frame(
  model = c("M0: const mu sigma", "M1: sigma(t), const mu", "M2: mu(t), const sigma", "M3: mu(t), sigma(t)", "M4:  SST family"),
  AIC   = c(GAIC(m0, k = 2), GAIC(m1, k = 2), GAIC(m2, k = 2), GAIC(m3, k = 2), GAIC(m4, k = 2))
)
print(aic_tbl)
```

<br>

The model where the sigma is the function of time and constant mu, has a lower AIC compared to the one where mu is in the function of time and constant sigma, which tells us that sigma is the more important parameter?

<br>

#### Sigma coefficient 

<br>

------------------------------------------------------------------------

### Cross-validation

<br> 

------------------------------------------------------------------------

## Simulation 3 {.tabset}

<br>

#### time-varying mean + time-varying variance + constant skewness 

<br>

### Models

<br>

```{r sim 3 setup, echo=FALSE}
# simulate
n          <- 800
t_index    <- seq_len(n)
t_scaled   <- (t_index - 1)/(n - 1)
beta <- 2

# Mean varies linearly
mu_t     <- pmax(0, mu0 + beta * t_scaled)

# Variance varies with time linearly
sigma_t  <- pmax(0, sigma0 + beta * t_scaled)

# constant skew
nu_const  <- 4     # skew parameter (constant)

y <- rSST(n, mu = mu_t, sigma = sigma_t, nu = nu_const, tau = 10)

dat <- data.frame(
  t = t_index,
  t_scaled = t_scaled,
  y = y,
  mu_true = mu_t,
  sd_true = sigma_t,
  nu_true = nu_const,
  tau_true = 10
)
```

```{r plot sim 3, echo=FALSE}
# plot the sim 
ggplot(dat, aes(x = t)) +
  geom_line(
    aes(y = y),
    color = "darkred",
    linewidth = 0.8
  ) +
  labs(
    x = "Time",
    y = "Value"
  ) +
  theme_minimal(base_size = 14)
```

Fitted five models:

1. M0 -> Intercept model (constant mean and variance)
2. M1 -> Only variance varies smoothly with time 
3. M2 -> Only mean varies smoothly with time
4. M3 -> time-varying mean + time-varying variance
5. M4 -> time-varying mean + time-varying variance + constant skewness 

<br>

```{r sim 3 models}
# M0: constant mean + constant variance
m0 <- gamlss(y ~ 1, sigma.fo = ~ 1, family = LO(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M1: time-varying variance only + constant mean
m1 <- gamlss(y ~ 1, sigma.fo = ~ t_scaled, family = LO(), data = dat,  
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M2: time-varying mean only + constant variance 
m2 <- gamlss(y ~ t_scaled, sigma.fo = ~ 1, family = LO(), data = dat,  
  method =     mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M3: time-varying mean + time-varying variance
m3 <- gamlss(y ~ t_scaled, sigma.fo = ~ t_scaled, family = LO(), data = dat, 
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M4: time-varying mean + time-varying variance + constant skewness
m4 <- gamlss(y ~ t_scaled, sigma.fo = ~ t_scaled, nu.fo = ~ 1, family = SN1(), data = dat,  
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M5: time-varying mean + time-varying variance + constant skewness + constant kurtosis (with SST family)
m5 <- gamlss(y ~ t_scaled, sigma.fo = ~ t_scaled, nu.fo = ~ 1, family = SST(), data = dat,  
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M6: time-varying mean + time-varying variance + constant skewness + constant kurtosis (with BCT family)
m6 <- gamlss(y ~ t_scaled, sigma.fo = ~ t_scaled, nu.fo = ~ 1, family = BCT(), data = dat,  
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M6: time-varying mean + time-varying variance + constant skewness + constant kurtosis (with BCT family)
m7 <- gamlss(y ~ t_scaled, sigma.fo = ~ t_scaled, tau.fo = ~ 1, family = TF2(), data = dat,
  method = mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))
#?LO
```

<br>

------------------------------------------------------------------------

### Full model summary

```{r}
summary(m0)
summary(m1)
summary(m2)
summary(m3)
summary(m4)
summary(m5)
```

<br>

------------------------------------------------------------------------

### Significant diagnostics

#### AIC 

```{r sim 3 AIC, echo=FALSE}
aic_tbl <- data.frame(
  model = c("M0: const mu sigma", "M1: sigma(t), const mu", "M2: mu(t), const sigma", "M3: mu(t), sigma(t)", "M4: mu(t), sigma(t), nu const", "M5: SST family", "M6:  BCT fam", "M7: tF2"),
  AIC   = c(GAIC(m0, k = 2), GAIC(m1, k = 2), GAIC(m2, k = 2), GAIC(m3, k = 2), GAIC(m4, k = 2), GAIC(m5, k = 2), GAIC(m6, k = 2),  GAIC(m7, k = 2))
)
print(aic_tbl)
#?BCT

# explore data too then go back to simulation
# use SST fam and change sims and see changes 
```

<br>

#### Sigma coefficient 

<br>

------------------------------------------------------------------------

### Cross-validation

<br> 

------------------------------------------------------------------------

## Simulation 4 {.tabset}

<br>

#### time-varying mean + time-varying variance + constant kurtosis 

<br>

### Models

<br>

```{r sim 4 setup, echo=FALSE, eval=FALSE}
# simulate
n          <- 800
t_index    <- seq_len(n)
t_scaled   <- (t_index - 1)/(n - 1)
beta <- 2

# Mean varies linear 
mu_t     <- pmax(0, mu0 + beta * t_scaled)

# Variance varies with time
sigma_t  <- pmax(0, sigma0 + beta * t_scaled)


# constant tail heaviness
tau_const <- 5     # tail/heaviness (constant)

y <- rSST(n, mu = mu_t, sigma = sigma_t, nu = 1, tau = tau_const)

dat <- data.frame(
  t = t_index,
  t_scaled = t_scaled,
  y = y,
  mu_true = mu_t,
  sd_true = sigma_t,
  nu_true = 1,
  tau_true = tau_const
)
```

```{r plot sim 4, echo=FALSE, eval=FALSE}
# plot the sim 
ggplot(dat, aes(x = t)) +
  geom_line(
    aes(y = y),
    color = "darkred",
    linewidth = 0.8
  ) +
  labs(
    x = "Time",
    y = "Value"
  ) +
  theme_minimal(base_size = 14)
```

Fitted five models:

1. M0 -> Intercept model (constant mean and variance)
2. M1 -> Only variance varies smoothly with time 
3. M2 -> Only mean varies smoothly with time
4. M3 -> time-varying mean + time-varying variance
5. M4 -> time-varying mean + time-varying variance + constant kurtosis 

<br>

```{r sim 4 models, eval=FALSE}
# M0: constant mean + constant variance
m0 <- gamlss(y ~ 1, sigma.fo = ~ 1, family = LO(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M1: time-varying variance only + constant mean
m1 <- gamlss(y ~ 1, sigma.fo = ~ pb(t_scaled), family = LO(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M2: time-varying mean only + constant variance 
m2 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ 1, family = LO(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M3: time-varying mean + time-varying variance
m3 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), family = LO(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M4: time-varying mean + time-varying variance + constant heavy tail
m4 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), tau.fo = ~ 1, family = TF2(),
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M5: time-varying mean + time-varying variance + constant heavy tail (SST fam)
m5 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), tau.fo = ~ 1, family = SST(),
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))
```

<br>

------------------------------------------------------------------------

### Full model summary

```{r, eval=FALSE}
summary(m0)
summary(m1)
summary(m2)
summary(m3)
summary(m4)
```

<br>

------------------------------------------------------------------------

### Significant diagnostics

#### AIC 

```{r sim 4 AIC, echo=FALSE, eval=FALSE}
aic_tbl <- data.frame(
  model = c("M0: const mu sigma", "M1: sigma(t), const mu", "M2: mu(t), const sigma", "M3: mu(t), sigma(t)", "M4: my(t), sigma(t), tau const", "M5:  SST fam"),
  AIC   = c(GAIC(m0, k = 2), GAIC(m1, k = 2), GAIC(m2, k = 2), GAIC(m3, k = 2), GAIC(m4, k = 2), GAIC(m5, k = 2))
)
print(aic_tbl)
```

<br>

#### Sigma coefficient 

<br>

------------------------------------------------------------------------

### Cross-validation

<br> 

------------------------------------------------------------------------

## Simulation 5 {.tabset}

<br>

#### time-varying mean + time-varying variance + constant skewness + constant kurtosis 

<br>

### Models

<br>

```{r sim 5 setup, echo=FALSE, eval=FALSE}
# simulate
n          <- 800
t_index    <- seq_len(n)
t_scaled   <- (t_index - 1)/(n - 1)
beta <- 2

# Mean varies linear 
mu_t     <- pmax(0, mu0 + beta * t_scaled)

# Variance varies with time
sigma_t  <- pmax(0, sigma0 + beta * t_scaled)

# constant skewness and tail heaviness
nu_const  <- 4     # skew parameter (constant)
tau_const <- 5     # tail/heaviness (constant)

y <- rSST(n, mu = mu_t, sigma = sigma_t, nu = nu_const, tau = tau_const)

dat <- data.frame(
  t = t_index,
  t_scaled = t_scaled,
  y = y,
  mu_true = mu_t,
  sd_true = sigma_t,
  nu_true = nu_const,
  tau_true = tau_const
)
```

```{r plot sim 5, echo=FALSE, eval=FALSE}
# plot the sim 
ggplot(dat, aes(x = t)) +
  geom_line(
    aes(y = y),
    color = "darkred",
    linewidth = 0.8
  ) +
  labs(
    x = "Time",
    y = "Value"
  ) +
  theme_minimal(base_size = 14)
```

Fitted seven models:

1. M0 -> Intercept model (constant mean and variance)
2. M1 -> Only variance varies smoothly with time 
3. M2 -> Only mean varies smoothly with time
4. M3 -> time-varying mean + time-varying variance
5. M4 -> time-varying mean + time-varying variance + constant skewness 
6. M5 -> time-varying mean + time-varying variance + constant kurtosis
7. M6 -> time-varying mean + time-varying variance + constant skewness + constant kurtosis

<br>

```{r sim 5 models, warning=FALSE, eval=FALSE}
# M0: constant mean + constant variance
m0 <- gamlss(y ~ 1, sigma.fo = ~ 1, family = LO(), data = dat,
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M1: time-varying variance only + constant mean
m1 <- gamlss(y ~ 1, sigma.fo = ~ pb(t_scaled), family = LO(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M2: time-varying mean only + constant variance 
m2 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ 1, family = LO(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M3: time-varying mean + time-varying variance
m3 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), family = LO(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M4: time-varying mean + time-varying variance + constant kurtosis
m4 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), tau.fo = ~ 1, family = TF2(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M5: time-varying mean + time-varying variance + constant skewness
m5 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), nu.fo = ~ 1, family = SN1(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M6: time-varying mean + time-varying variance + constant skewness + constant kurtosis
m6 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), nu.fo = ~ 1, tau.fo = ~ 1, family = SST(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))
```

<br>

------------------------------------------------------------------------

### Full model summary

```{r, eval=FALSE}
summary(m0)
summary(m1)
summary(m2)
summary(m3)
summary(m4)
summary(m5)
summary(m6)
```

<br>

------------------------------------------------------------------------

### Significant diagnostics

#### AIC 

```{r sim 5 AIC, echo=FALSE, eval=FALSE}
aic_tbl <- data.frame(
  model = c("M0: const mu sigma", "M1: sigma(t), const mu", "M2: mu(t), const sigma", "M3: mu(t), sigma(t)", "M4: my(t), sigma(t), nu const", "M5: my(t), sigma(t), tau const", "M6: my(t), sigma(t), nu const, tau const"),
  AIC   = c(GAIC(m0, k = 2), GAIC(m1, k = 2), GAIC(m2, k = 2), GAIC(m3, k = 2), GAIC(m4, k = 2), GAIC(m5, k = 2), GAIC(m6, k =2))
)
print(aic_tbl)
```

<br>

#### Sigma coefficient 

<br>

------------------------------------------------------------------------

### Cross-validation

<br> 

------------------------------------------------------------------------

## Simulation 6 {.tabset}

<br>

#### time-varying mean + time-varying variance + time-varying skewness + constant kurtosis 

<br>

### Models

<br>

```{r sim 6 setup, echo=FALSE,eval=FALSE}
# simulate
n          <- 800
t_index    <- seq_len(n)
t_scaled   <- (t_index - 1)/(n - 1)
beta <- 2

# Mean varies linear 
mu_t     <- pmax(0, mu0 + beta * t_scaled)

# Variance varies with time
sigma_t  <- pmax(0, sigma0 + beta * t_scaled)

# skewness and tail heaviness constant
nu_const <- 4
tau_const <- 5  

# nu varies with time
nu_t    <- nu_const    + beta  * t_scaled
  

y <- rSST(n, mu = mu_t, sigma = sigma_t, nu = nu_t, tau = tau_const)

dat <- data.frame(
  t = t_index,
  t_scaled = t_scaled,
  y = y,
  mu_true = mu_t,
  sd_true = sigma_t,
  nu_true = nu_t,
  tau_true = tau_const
)
```

```{r plot sim 6, echo=FALSE, eval=FALSE}
# plot the sim 
ggplot(dat, aes(x = t)) +
  geom_line(
    aes(y = y),
    color = "darkred",
    linewidth = 0.8
  ) +
  labs(
    x = "Time",
    y = "Value"
  ) +
  theme_minimal(base_size = 14)
```

Fitted seven models:

1. M0 -> Intercept model (constant mean and variance)
2. M1 -> Only variance varies smoothly with time 
3. M2 -> Only mean varies smoothly with time
4. M3 -> time-varying mean + time-varying variance
5. M4 -> time-varying mean + time-varying variance + constant skewness 
6. M5 -> time-varying mean + time-varying variance + constant kurtosis
7. M6 -> time-varying mean + time-varying variance + constant skewness + constant kurtosis
8. M7 -> time-varying mean + time-varying variance + time-varying skewness + constant kurtosis

<br>

```{r sim 6 models, warning=FALSE, eval=FALSE}
# M0: constant mean + constant variance
m0 <- gamlss(y ~ 1, sigma.fo = ~ 1, family = SST(), data = dat,  
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M1: time-varying variance only + constant mean
m1 <- gamlss(y ~ 1, sigma.fo = ~ pb(t_scaled), family = SST(), data = dat,  
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M2: time-varying mean only + constant variance 
m2 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ 1, family = SST(), data = dat,  
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M3: time-varying mean + time-varying variance
m3 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), family = SST(), data = dat, 
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M4: time-varying mean + time-varying variance + constant skewness
m4 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), tau.fo = ~ 1, family = SST(), data = dat,  
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M5: time-varying mean + time-varying variance + constant kurtosis
m5 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), nu.fo = ~ 1, family = SST(), data = dat,  method =       
  mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M6: time-varying mean + time-varying variance + constant skewness + constant kurtosis
m6 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), nu.fo = ~ 1, tau.fo = ~ 1, family = SST(), data = dat,  
  method =       mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M7: time-varying mean + time-varying variance + time-varying skewness + constant kurtosis
m7 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), nu.fo = ~ pb(t_scaled), tau.fo = ~ 1, family = SST(), data = dat,  
  method =  mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))
```

<br>

------------------------------------------------------------------------

### Full model summary

```{r, eval=FALSE}
summary(m0)
summary(m1)
summary(m2)
summary(m3)
summary(m4)
summary(m5)
summary(m6)
summary(m7)
```

<br>

------------------------------------------------------------------------

### Significant diagnostics

#### AIC 

```{r sim 6 AIC, echo=FALSE, eval=FALSE}
aic_tbl <- data.frame(
  model = c("M0: const mu sigma", "M1: sigma(t), const mu", "M2: mu(t), const sigma", "M3: mu(t), sigma(t)", "M4: my(t), sigma(t), nu const", "M5: my(t), sigma(t), tau const", "M6: mu(t), sigma(t), nu const, tau const", "M7: mu(t), sigma(t), nu(t), tau const"),
  AIC   = c(GAIC(m0, k = 2), GAIC(m1, k = 2), GAIC(m2, k = 2), GAIC(m3, k = 2), GAIC(m4, k = 2), GAIC(m5, k = 2), GAIC(m6, k = 2), GAIC(m7, k = 2))
)
print(aic_tbl)
```

<br>

#### Sigma coefficient 

<br>

------------------------------------------------------------------------

### Cross-validation

<br> 

------------------------------------------------------------------------

## Simulation 7 {.tabset}

<br>

#### time-varying mean + time-varying variance + constant skewness + time-varying kurtosis 

<br>

### Models

<br>

```{r sim 7 setup, echo=FALSE, eval=FALSE}
# simulate
n          <- 800
t_index    <- seq_len(n)
t_scaled   <- (t_index - 1)/(n - 1)
beta <- 2
beta_tau   <- -1 

# Mean varies linear 
mu_t     <- pmax(0, mu0 + beta * t_scaled)

# Variance varies with time
sigma_t  <- pmax(0, sigma0 + beta * t_scaled)

# skewness and tail heaviness constant
nu_const <- 4
tau_const <- 5  

# nu varies with time
tau_t    <- tau_const    + beta_tau * t_scaled

y <- rSST(n, mu = mu_t, sigma = sigma_t, nu = nu_const, tau = tau_t)

dat <- data.frame(
  t = t_index,
  t_scaled = t_scaled,
  y = y,
  mu_true = mu_t,
  sd_true = sigma_t,
  nu_true = nu_const,
  tau_true = tau_t
)
```

```{r plot sim 7, echo=FALSE, eval=FALSE}
# plot the sim 
ggplot(dat, aes(x = t)) +
  geom_line(
    aes(y = y),
    color = "darkred",
    linewidth = 0.8
  ) +
  labs(
    x = "Time",
    y = "Value"
  ) +
  theme_minimal(base_size = 14)
```

Fitted seven models:

1. M0 -> Intercept model (constant mean and variance)
2. M1 -> Only variance varies smoothly with time 
3. M2 -> Only mean varies smoothly with time
4. M3 -> time-varying mean + time-varying variance
5. M4 -> time-varying mean + time-varying variance + constant skewness 
6. M5 -> time-varying mean + time-varying variance + constant kurtosis
7. M6 -> time-varying mean + time-varying variance + constant skewness + constant kurtosis
8. M7 -> time-varying mean + time-varying variance + constant skewness + time-varying kurtosis

<br>

```{r sim 7 models, warning=FALSE, eval=FALSE}
# M0: constant mean + constant variance
m0 <- gamlss(y ~ 1, sigma.fo = ~ 1, family = SST(), data = dat, 
  method =  mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M1: time-varying variance only + constant mean
m1 <- gamlss(y ~ 1, sigma.fo = ~ pb(t_scaled), family = SST(), data = dat, 
  method =  mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M2: time-varying mean only + constant variance 
m2 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ 1, family = SST(), data = dat, 
  method =  mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M3: time-varying mean + time-varying variance
m3 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), family = SST(), data = dat, 
  method =  mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M4: time-varying mean + time-varying variance + constant skewness
m4 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), tau.fo = ~ 1, family = SST(), data = dat, 
  method =  mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M5: time-varying mean + time-varying variance + constant kurtosis
m5 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), nu.fo = ~ 1, family = SST(), data = dat, 
  method =  mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M6: time-varying mean + time-varying variance + constant skewness + constant kurtosis
m6 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), nu.fo = ~ 1, tau.fo = ~ 1, family = SST(), data = dat, 
  method =  mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# M7: time-varying mean + time-varying variance + constant skewness + time-varying kurtosis
m7 <- gamlss(y ~ pb(t_scaled), sigma.fo = ~ pb(t_scaled), nu.fo = ~ 1, tau.fo = ~ pb(t_scaled), family = SST(), data = dat, 
  method =  mixed(5, 200),
  control = gamlss.control(n.cyc = 400, c.crit = 0.01, trace = FALSE))

# logLik(m0)
# logLik(wth)
```

<br>

------------------------------------------------------------------------

### Full model summary

```{r, eval=FALSE}
summary(m0)
summary(wth)
summary(m1)
summary(m2)
summary(m3)
summary(m4)
summary(m5)
summary(m6)
summary(m7)
```

<br>

------------------------------------------------------------------------

### Significant diagnostics

#### AIC 

```{r sim 7 AIC, echo=FALSE, eval=FALSE}
aic_tbl <- data.frame(
  model = c("M0: const mu sigma", "wth", "M1: sigma(t), const mu", "M2: mu(t), const sigma", "M3: mu(t), sigma(t)", "M4: my(t), sigma(t), nu const", "M5: my(t), sigma(t), tau const", "M6: mu(t), sigma(t), nu const, tau const", "M7: mu(t), sigma(t), nu const, tau(t)"),
  AIC   = c(GAIC(m0, k = 2), GAIC(wth, k = 2), GAIC(m1, k = 2), GAIC(m2, k = 2), GAIC(m3, k = 2), GAIC(m4, k = 2), GAIC(m5, k = 2), GAIC(m6, k = 2), GAIC(m7, k = 2))
)
print(aic_tbl)
```

<br>

#### Sigma coefficient 

<br>

------------------------------------------------------------------------

### Cross-validation

<br> 

------------------------------------------------------------------------